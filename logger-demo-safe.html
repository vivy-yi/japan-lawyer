<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¿—ç³»ç»Ÿå®‰å…¨æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            background-color: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
        }
        .demo-section {
            margin: 25px 0;
            padding: 20px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.secondary {
            background: #6c757d;
        }
        .btn.secondary:hover {
            background: #545b62;
        }
        .status {
            padding: 12px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        #log-output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            line-height: 1.4;
        }
        .info-panel {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 25px;
        }
        .info-panel h3 {
            margin-top: 0;
            color: #1976d2;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "âœ“ ";
            color: #28a745;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” ç»Ÿä¸€æ—¥å¿—ç®¡ç†ç³»ç»Ÿ</h1>
            <p>å¼€å‘ç¯å¢ƒè‡ªåŠ¨å¼€å¯ï¼Œç”Ÿäº§ç¯å¢ƒè‡ªåŠ¨å…³é—­çš„å®‰å…¨æ—¥å¿—ç³»ç»Ÿ</p>
        </div>

        <div class="info-panel">
            <h3>ğŸŒŸ æ ¸å¿ƒç‰¹æ€§</h3>
            <div class="grid">
                <ul class="feature-list">
                    <li>ç¯å¢ƒè‡ªåŠ¨æ£€æµ‹</li>
                    <li>å¤šçº§åˆ«æ—¥å¿—è®°å½•</li>
                    <li>æ€§èƒ½ç›‘æ§é›†æˆ</li>
                    <li>æœ¬åœ°å­˜å‚¨æ”¯æŒ</li>
                    <li>å…¨å±€é”™è¯¯æ•è·</li>
                    <li>å¼€å‘è€…å·¥å…·é›†æˆ</li>
                </ul>
                <ul class="feature-list">
                    <li>ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–</li>
                    <li>æ—¥å¿—å¯¼å‡ºåŠŸèƒ½</li>
                    <li>å®æ—¶ç»Ÿè®¡åˆ†æ</li>
                    <li>å†…å­˜ç®¡ç†</li>
                    <li>XSSé˜²æŠ¤</li>
                    <li>æ¨¡å—åŒ–æ¶æ„</li>
                </ul>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸ“Š ç¯å¢ƒä¿¡æ¯</h3>
            <div id="env-info">
                <p><em>æ£€æµ‹ç¯å¢ƒä¸­...</em></p>
            </div>
        </div>

        <div class="demo-section">
            <h3>ğŸ§ª æ—¥å¿—åŠŸèƒ½æµ‹è¯•</h3>
            <button class="btn" onclick="testBasicLogging()">æµ‹è¯•åŸºç¡€æ—¥å¿—</button>
            <button class="btn" onclick="testPerformance()">æ€§èƒ½ç›‘æ§æµ‹è¯•</button>
            <button class="btn" onclick="testErrorHandling()">é”™è¯¯å¤„ç†æµ‹è¯•</button>
            <button class="btn secondary" onclick="testLogStats()">æ—¥å¿—ç»Ÿè®¡</button>
            <button class="btn secondary" onclick="exportLogs()">å¯¼å‡ºæ—¥å¿—</button>
            <button class="btn secondary" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
        </div>

        <div class="demo-section">
            <h3>ğŸ“ å®æ—¶æ—¥å¿—è¾“å‡º</h3>
            <div id="log-output">ç­‰å¾…æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–...</div>
        </div>
    </div>

    <!-- å¼•å…¥æ—¥å¿—ç³»ç»Ÿ -->
    <script src="js/logger-init.js"></script>

    <script>
        // å®‰å…¨çš„DOMæ“ä½œå‡½æ•°
        function createElement(tag, text, className = '') {
            const element = document.createElement(tag);
            if (text) element.textContent = text;
            if (className) element.className = className;
            return element;
        }

        let outputDiv = document.getElementById('log-output');
        let envInfoDiv = document.getElementById('env-info');

        // ç­‰å¾…æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–
        window.addEventListener('logger:initialized', function(e) {
            showStatus('âœ… æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ', 'success');
            updateEnvironmentInfo(e.detail.environment);
            appendOutput('ğŸš€ æ—¥å¿—ç³»ç»Ÿå·²å°±ç»ªï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•\n');
        });

        // åŸºç¡€æ—¥å¿—æµ‹è¯•
        function testBasicLogging() {
            if (!window.APP_DEBUG) {
                showStatus('âŒ æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            appendOutput('=== åŸºç¡€æ—¥å¿—æµ‹è¯• ===');

            window.APP_DEBUG.debug('è°ƒè¯•ä¿¡æ¯æµ‹è¯•', {
                timestamp: Date.now(),
                feature: 'basic-logging'
            });

            window.APP_DEBUG.info('ä¿¡æ¯æ—¥å¿—æµ‹è¯•', {
                userAction: 'button-click',
                context: 'demo-page'
            });

            window.APP_DEBUG.warn('è­¦å‘Šä¿¡æ¯æµ‹è¯•', {
                warningLevel: 'medium',
                suggestion: 'check configuration'
            });

            window.APP_DEBUG.error('é”™è¯¯ä¿¡æ¯æµ‹è¯•', {
                errorCode: 'DEMO_ERROR',
                severity: 'low',
                handled: true
            }, 'LOG_DEMO');

            appendOutput('âœ… åŸºç¡€æ—¥å¿—æµ‹è¯•å®Œæˆ\n');
        }

        // æ€§èƒ½ç›‘æ§æµ‹è¯•
        function testPerformance() {
            if (!window.APP_DEBUG) {
                showStatus('âŒ æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            appendOutput('=== æ€§èƒ½ç›‘æ§æµ‹è¯• ===');

            // å¼€å§‹æ€§èƒ½ç›‘æ§
            window.APP_DEBUG.startTimer('demo-task');

            // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ
            setTimeout(() => {
                window.APP_DEBUG.endTimer('demo-task');

                // æ”¶é›†æ€§èƒ½æ•°æ®
                if ('performance' in window && 'timing' in performance) {
                    const timing = performance.timing;
                    const perfData = {
                        loadTime: timing.loadEventEnd - timing.navigationStart,
                        domReady: timing.domContentLoadedEventEnd - timing.navigationStart
                    };

                    window.APP_DEBUG.info('é¡µé¢æ€§èƒ½æ•°æ®', perfData, 'PERFORMANCE');
                    appendOutput(`æ€§èƒ½æ•°æ®: ${JSON.stringify(perfData, null, 2)}`);
                }

                appendOutput('âœ… æ€§èƒ½ç›‘æ§æµ‹è¯•å®Œæˆ\n');
            }, 800);
        }

        // é”™è¯¯å¤„ç†æµ‹è¯•
        function testErrorHandling() {
            if (!window.APP_DEBUG) {
                showStatus('âŒ æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            appendOutput('=== é”™è¯¯å¤„ç†æµ‹è¯• ===');

            // æµ‹è¯•åŒæ­¥é”™è¯¯
            try {
                throw new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯');
            } catch (error) {
                window.APP_DEBUG.error('åŒæ­¥é”™è¯¯æ•è·', error, {
                    phase: 'try-catch-test',
                    recoverable: true
                });
            }

            // æµ‹è¯•å¼‚æ­¥é”™è¯¯
            Promise.reject(new Error('Promise æ‹’ç»æµ‹è¯•'))
                .catch(error => {
                    window.APP_DEBUG.error('å¼‚æ­¥é”™è¯¯å¤„ç†', error, {
                        type: 'promise-rejection',
                        caught: true
                    });
                });

            appendOutput('âœ… é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆ\n');
        }

        // æ—¥å¿—ç»Ÿè®¡
        function testLogStats() {
            if (!window.APP_DEBUG) {
                showStatus('âŒ æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            appendOutput('=== æ—¥å¿—ç»Ÿè®¡ä¿¡æ¯ ===');

            const stats = window.APP_DEBUG.getStats();
            appendOutput(`æ€»æ—¥å¿—æ•°: ${stats.total}`);

            if (stats.byLevel && Object.keys(stats.byLevel).length > 0) {
                appendOutput('æŒ‰çº§åˆ«ç»Ÿè®¡:');
                Object.entries(stats.byLevel).forEach(([level, count]) => {
                    appendOutput(`  ${level}: ${count}`);
                });
            }

            if (stats.recentErrors && stats.recentErrors.length > 0) {
                appendOutput(`æœ€è¿‘é”™è¯¯ (${stats.recentErrors.length}ä¸ª):`);
                stats.recentErrors.forEach((error, index) => {
                    appendOutput(`  ${index + 1}. ${error.message}`);
                });
            }

            appendOutput('\nâœ… ç»Ÿè®¡ä¿¡æ¯è·å–å®Œæˆ\n');
        }

        // å¯¼å‡ºæ—¥å¿—
        function exportLogs() {
            if (!window.APP_DEBUG) {
                showStatus('âŒ æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                window.APP_DEBUG.exportLogs();
                showStatus('ğŸ“¥ æ—¥å¿—å·²å¯¼å‡º', 'success');
                appendOutput('ğŸ“¥ æ—¥å¿—å·²å¯¼å‡ºåˆ°æ–‡ä»¶\n');
            } catch (error) {
                showStatus('âŒ æ—¥å¿—å¯¼å‡ºå¤±è´¥', 'error');
                appendOutput(`âŒ å¯¼å‡ºé”™è¯¯: ${error.message}\n`);
            }
        }

        // æ¸…é™¤æ—¥å¿—
        function clearLogs() {
            if (!window.APP_DEBUG) {
                showStatus('âŒ æ—¥å¿—ç³»ç»Ÿæœªåˆå§‹åŒ–', 'error');
                return;
            }

            window.APP_DEBUG.clearLogs();
            outputDiv.textContent = 'æ—¥å¿—å·²æ¸…é™¤';
            showStatus('âœ… æ—¥å¿—å·²æ¸…é™¤', 'success');
        }

        // æ›´æ–°ç¯å¢ƒä¿¡æ¯ - å®Œå…¨å®‰å…¨çš„æ–¹å¼
        function updateEnvironmentInfo(environment) {
            // æ¸…ç©ºç°æœ‰å†…å®¹
            while (envInfoDiv.firstChild) {
                envInfoDiv.removeChild(envInfoDiv.firstChild);
            }

            // æ·»åŠ æ–°çš„ä¿¡æ¯
            const info = [
                ['å½“å‰ç¯å¢ƒ', environment.current],
                ['å¼€å‘æ¨¡å¼', environment.isDevelopment ? 'æ˜¯' : 'å¦'],
                ['æµ‹è¯•æ¨¡å¼', environment.isTest ? 'æ˜¯' : 'å¦'],
                ['ç”Ÿäº§æ¨¡å¼', environment.isProduction ? 'æ˜¯' : 'å¦'],
                ['ä¸»æœºåœ°å€', environment.hostname],
                ['é€šä¿¡åè®®', environment.protocol]
            ];

            info.forEach(([label, value]) => {
                const p = createElement('p');
                const strong = createElement('strong', `${label}: `);
                p.appendChild(strong);
                p.appendChild(document.createTextNode(value));
                envInfoDiv.appendChild(p);
            });
        }

        // æ˜¾ç¤ºçŠ¶æ€ä¿¡æ¯ - å®Œå…¨å®‰å…¨çš„æ–¹å¼
        function showStatus(message, type) {
            const statusDiv = createElement('div', message, `status ${type}`);
            const container = document.querySelector('.container');
            const firstSection = container.querySelector('.demo-section');

            container.insertBefore(statusDiv, firstSection);

            setTimeout(() => {
                if (statusDiv.parentNode === container) {
                    container.removeChild(statusDiv);
                }
            }, 4000);
        }

        // æ·»åŠ è¾“å‡ºåˆ°æ˜¾ç¤ºåŒºåŸŸ
        function appendOutput(text) {
            if (outputDiv.textContent === 'ç­‰å¾…æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–...' ||
                outputDiv.textContent === 'æ—¥å¿—å·²æ¸…é™¤') {
                outputDiv.textContent = '';
            }
            outputDiv.textContent += text + '\n';
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (!window.APP_DEBUG) {
                    showStatus('âš ï¸ æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–è¶…æ—¶', 'error');
                    appendOutput('âŒ æ—¥å¿—ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥\n');

                    // æ‰‹åŠ¨æ›´æ–°ç¯å¢ƒä¿¡æ¯
                    const hostname = window.location.hostname;
                    const isDev = hostname === 'localhost' || hostname === '127.0.0.1';
                    updateEnvironmentInfo({
                        current: isDev ? 'development' : 'unknown',
                        isDevelopment: isDev,
                        isTest: false,
                        isProduction: !isDev,
                        hostname: hostname,
                        protocol: window.location.protocol
                    });
                }
            }, 3000);
        });
    </script>
</body>
</html>